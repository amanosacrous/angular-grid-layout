/**
 * IMPORTANT:
 * This utils are taken from the project: https://github.com/STRML/react-grid-layout.
 * The code should be as less modified as possible for easy maintenance.
 */
import { getAllCollisions, getFirstCollision, sortLayoutItems } from "./react-grid-layout.utils";
const DEBUG = false;
// Disable lint since we don't want to modify this code
/* eslint-disable */
/**
 * Move an element. Responsible for doing cascading movements of other elements.
 *
 * @param  {Array}      layout            Full layout to modify.
 * @param  {LayoutItem} l                 element to move.
 * @param  {Number}     [x]               X position in grid units.
 * @param  {Number}     [y]               Y position in grid units.
 */
export function moveElements(layout, items, isUserAction, compactType, cols, movingUpUser) {
    const oldX = items[0].l.x;
    const oldY = items[0].l.y;
    const oldCoord = {};
    items.forEach;
    items.forEach((item) => {
        oldCoord[item.l.id] = {
            x: item.l.x,
            y: item.l.y
        };
        if (typeof item.x === 'number') {
            item.l.x = item.x;
        }
        if (typeof item.y === 'number') {
            item.l.y = item.y;
        }
        item.l.moved = true;
    });
    let sorted = sortLayoutItems(layout, compactType);
    // If this collides with anything, move it.
    // When doing this comparison, we have to sort the items we compare with
    // to ensure, in the case of multiple collisions, that we're getting the
    // nearest collision.
    const movingUp = compactType === 'vertical' && typeof items[0].y === 'number'
        ? oldY >= items[0].y
        : compactType === 'horizontal' && typeof items[0].x === 'number'
            ? oldX >= items[0].x
            : false;
    if (movingUp) {
        sorted = sorted.reverse();
    }
    if (isUserAction) {
        movingUpUser = movingUp;
    }
    items.forEach((item) => {
        const collisions = getAllCollisions(sorted, item.l);
        // Move each item that collides away from this element.
        for (let i = 0, len = collisions.length; i < len; i++) {
            const collision = collisions[i];
            logMulti(`Resolving collision between ${items}] and ${collision.id} at [${collision.x},${collision.y}]`);
            // Short circuit so we can't infinite loop
            if (collision.moved) {
                continue;
            }
            // Don't move static items - we have to move *this* element away
            if (collision.static) {
                layout = moveElementsAwayFromCollision(layout, collision, item.l, isUserAction, compactType, cols, movingUpUser);
            }
            else {
                layout = moveElementsAwayFromCollision(layout, item.l, collision, isUserAction, compactType, cols, movingUpUser);
            }
        }
    });
    return layout;
}
export function moveElementsAwayFromCollision(layout, collidesWith, itemToMove, isUserAction, compactType, cols, movingUp) {
    const compactH = compactType === 'horizontal';
    // Compact vertically if not set to horizontal
    const compactV = compactType !== 'horizontal';
    const preventCollision = collidesWith.static; // we're already colliding (not for static items)
    // If there is enough space above the collision to put this element, move it there.
    // We only do this on the main collision as this can get funky in cascades and cause
    // unwanted swapping behavior.
    if (isUserAction) {
        // Reset isUserAction flag because we're not in the main collision anymore.
        isUserAction = false;
        // Make a mock item so we don't modify the item here, only modify in moveElement.
        const fakeItem = {
            x: compactH
                ? Math.max(collidesWith.x - itemToMove.w, 0)
                : itemToMove.x,
            y: compactV
                ? Math.max(collidesWith.y - itemToMove.h, 0)
                : itemToMove.y,
            w: itemToMove.w,
            h: itemToMove.h,
            id: '-1',
        };
        // No collision? If so, we can go up there; otherwise, we'll end up moving down as normal
        if (!getFirstCollision(layout, fakeItem)) {
            logMulti(`Doing reverse collision on ${itemToMove.id} up to [${fakeItem.x},${fakeItem.y}].`);
            return moveElements(layout, [{
                    l: itemToMove,
                    x: compactH ? fakeItem.x : undefined,
                    y: compactV ? fakeItem.y : undefined,
                }], isUserAction, compactType, cols, movingUp);
        }
    }
    return moveElements(layout, [{
            l: itemToMove,
            x: compactH ? itemToMove.x + 1 : undefined,
            y: compactV ? itemToMove.y + 1 : undefined,
        }], isUserAction, compactType, cols, movingUp);
}
function logMulti(...args) {
    if (!DEBUG) {
        return;
    }
    // eslint-disable-next-line no-console
    console.log(...args);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVhY3QtZ3JpZC1sYXlvdXQtbXVsdGlwbGUudXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyLWdyaWQtbGF5b3V0L3NyYy9saWIvdXRpbHMvcmVhY3QtZ3JpZC1sYXlvdXQtbXVsdGlwbGUudXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFBZSxnQkFBZ0IsRUFBRSxpQkFBaUIsRUFBc0IsZUFBZSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFFbEksTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDO0FBRXBCLHVEQUF1RDtBQUN2RCxvQkFBb0I7QUFFcEI7Ozs7Ozs7R0FPRztBQUNILE1BQU0sVUFBVSxZQUFZLENBQ3hCLE1BQWMsRUFDZCxLQUlHLEVBQ0gsWUFBd0MsRUFDeEMsV0FBd0IsRUFDeEIsSUFBWSxFQUNaLFlBQXFCO0lBRXJCLE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzFCLE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzFCLE1BQU0sUUFBUSxHQUFHLEVBQUUsQ0FBQTtJQUVuQixLQUFLLENBQUMsT0FBTyxDQUFBO0lBQ2IsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksRUFBQyxFQUFFO1FBQ2xCLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFDO1lBQ2hCLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDWCxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ2QsQ0FBQTtRQUNELElBQUksT0FBTyxJQUFJLENBQUMsQ0FBQyxLQUFLLFFBQVEsRUFBRTtZQUM1QixJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FB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RUQsT0FBTyxZQUFZLENBQ2YsTUFBTSxFQUNOLENBQUM7WUFDRyxDQUFDLEVBQUUsVUFBVTtZQUNiLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTO1lBQ3hDLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTO1NBQzNDLENBQUMsRUFDRixZQUFZLEVBQ1osV0FBVyxFQUNYLElBQUksRUFDSixRQUFRLENBQ1gsQ0FBQztBQUNOLENBQUM7QUFFRCxTQUFTLFFBQVEsQ0FBQyxHQUFHLElBQUk7SUFDckIsSUFBSSxDQUFDLEtBQUssRUFBRTtRQUNSLE9BQU87S0FDVjtJQUNELHNDQUFzQztJQUN0QyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7QUFDekIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBJTVBPUlRBTlQ6XHJcbiAqIFRoaXMgdXRpbHMgYXJlIHRha2VuIGZyb20gdGhlIHByb2plY3Q6IGh0dHBzOi8vZ2l0aHViLmNvbS9TVFJNTC9yZWFjdC1ncmlkLWxheW91dC5cclxuICogVGhlIGNvZGUgc2hvdWxkIGJlIGFzIGxlc3MgbW9kaWZpZWQgYXMgcG9zc2libGUgZm9yIGVhc3kgbWFpbnRlbmFuY2UuXHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgQ29tcGFjdFR5cGUsIGdldEFsbENvbGxpc2lvbnMsIGdldEZpcnN0Q29sbGlzaW9uLCBMYXlvdXQsIExheW91dEl0ZW0sIHNvcnRMYXlvdXRJdGVtcyB9IGZyb20gXCIuL3JlYWN0LWdyaWQtbGF5b3V0LnV0aWxzXCI7XHJcblxyXG5jb25zdCBERUJVRyA9IGZhbHNlO1xyXG5cclxuLy8gRGlzYWJsZSBsaW50IHNpbmNlIHdlIGRvbid0IHdhbnQgdG8gbW9kaWZ5IHRoaXMgY29kZVxyXG4vKiBlc2xpbnQtZGlzYWJsZSAqL1xyXG5cclxuLyoqXHJcbiAqIE1vdmUgYW4gZWxlbWVudC4gUmVzcG9uc2libGUgZm9yIGRvaW5nIGNhc2NhZGluZyBtb3ZlbWVudHMgb2Ygb3RoZXIgZWxlbWVudHMuXHJcbiAqXHJcbiAqIEBwYXJhbSAge0FycmF5fSAgICAgIGxheW91dCAgICAgICAgICAgIEZ1bGwgbGF5b3V0IHRvIG1vZGlmeS5cclxuICogQHBhcmFtICB7TGF5b3V0SXRlbX0gbCAgICAgICAgICAgICAgICAgZWxlbWVudCB0byBtb3ZlLlxyXG4gKiBAcGFyYW0gIHtOdW1iZXJ9ICAgICBbeF0gICAgICAgICAgICAgICBYIHBvc2l0aW9uIGluIGdyaWQgdW5pdHMuXHJcbiAqIEBwYXJhbSAge051bWJlcn0gICAgIFt5XSAgICAgICAgICAgICAgIFkgcG9zaXRpb24gaW4gZ3JpZCB1bml0cy5cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBtb3ZlRWxlbWVudHMoXHJcbiAgICBsYXlvdXQ6IExheW91dCxcclxuICAgIGl0ZW1zOiB7XHJcbiAgICAgICAgbDogTGF5b3V0SXRlbSxcclxuICAgICAgICB4OiBudW1iZXIgfCBudWxsIHwgdW5kZWZpbmVkLFxyXG4gICAgICAgIHk6IG51bWJlciB8IG51bGwgfCB1bmRlZmluZWRcclxuICAgIH1bXSxcclxuICAgIGlzVXNlckFjdGlvbjogYm9vbGVhbiB8IG51bGwgfCB1bmRlZmluZWQsXHJcbiAgICBjb21wYWN0VHlwZTogQ29tcGFjdFR5cGUsXHJcbiAgICBjb2xzOiBudW1iZXIsXHJcbiAgICBtb3ZpbmdVcFVzZXI/OmJvb2xlYW5cclxuKTogTGF5b3V0IHtcclxuICAgIGNvbnN0IG9sZFggPSBpdGVtc1swXS5sLng7XHJcbiAgICBjb25zdCBvbGRZID0gaXRlbXNbMF0ubC55O1xyXG4gICAgY29uc3Qgb2xkQ29vcmQgPSB7fVxyXG5cclxuICAgIGl0ZW1zLmZvckVhY2hcclxuICAgIGl0ZW1zLmZvckVhY2goKGl0ZW0pPT57XHJcbiAgICAgICAgb2xkQ29vcmRbaXRlbS5sLmlkXT17XHJcbiAgICAgICAgICAgIHg6IGl0ZW0ubC54LFxyXG4gICAgICAgICAgICB5OiBpdGVtLmwueVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIGl0ZW0ueCA9PT0gJ251bWJlcicpIHtcclxuICAgICAgICAgICAgaXRlbS5sLnggPSBpdGVtLng7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0eXBlb2YgaXRlbS55ID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgIGl0ZW0ubC55ID0gaXRlbS55O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpdGVtLmwubW92ZWQgPSB0cnVlO1xyXG5cclxuICAgIH0pXHJcblxyXG4gICAgbGV0IHNvcnRlZCA9IHNvcnRMYXlvdXRJdGVtcyhsYXlvdXQsIGNvbXBhY3RUeXBlKTtcclxuICAgIC8vIElmIHRoaXMgY29sbGlkZXMgd2l0aCBhbnl0aGluZywgbW92ZSBpdC5cclxuICAgIC8vIFdoZW4gZG9pbmcgdGhpcyBjb21wYXJpc29uLCB3ZSBoYXZlIHRvIHNvcnQgdGhlIGl0ZW1zIHdlIGNvbXBhcmUgd2l0aFxyXG4gICAgLy8gdG8gZW5zdXJlLCBpbiB0aGUgY2FzZSBvZiBtdWx0aXBsZSBjb2xsaXNpb25zLCB0aGF0IHdlJ3JlIGdldHRpbmcgdGhlXHJcbiAgICAvLyBuZWFyZXN0IGNvbGxpc2lvbi5cclxuICAgIGNvbnN0IG1vdmluZ1VwID1cclxuICAgICAgICBjb21wYWN0VHlwZSA9PT0gJ3ZlcnRpY2FsJyAmJiB0eXBlb2YgaXRlbXNbMF0ueSA9PT0gJ251bWJlcidcclxuICAgICAgICAgICAgPyBvbGRZID49IGl0ZW1zWzBdLnlcclxuICAgICAgICAgICAgOiBjb21wYWN0VHlwZSA9PT0gJ2hvcml6b250YWwnICYmIHR5cGVvZiBpdGVtc1swXS54ID09PSAnbnVtYmVyJ1xyXG4gICAgICAgICAgICAgICAgPyBvbGRYID49IGl0ZW1zWzBdLnhcclxuICAgICAgICAgICAgICAgIDogZmFsc2U7XHJcbiAgICBpZiAobW92aW5nVXApIHtcclxuICAgICAgICBzb3J0ZWQgPSBzb3J0ZWQucmV2ZXJzZSgpO1xyXG4gICAgfVxyXG4gICAgaWYoaXNVc2VyQWN0aW9uKXtcclxuICAgICAgICBtb3ZpbmdVcFVzZXIgPSBtb3ZpbmdVcDtcclxuICAgIH1cclxuXHJcbiAgICBpdGVtcy5mb3JFYWNoKChpdGVtKT0+e1xyXG4gICAgICAgIGNvbnN0IGNvbGxpc2lvbnM6IExheW91dEl0ZW1bXSA9IGdldEFsbENvbGxpc2lvbnMoc29ydGVkLCBpdGVtLmwpO1xyXG4gICAgICAgIC8vIE1vdmUgZWFjaCBpdGVtIHRoYXQgY29sbGlkZXMgYXdheSBmcm9tIHRoaXMgZWxlbWVudC5cclxuICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gY29sbGlzaW9ucy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCBjb2xsaXNpb24gPSBjb2xsaXNpb25zW2ldO1xyXG4gICAgICAgICAgICBsb2dNdWx0aShcclxuICAgICAgICAgICAgICAgIGBSZXNvbHZpbmcgY29sbGlzaW9uIGJldHdlZW4gJHtpdGVtc31dIGFuZCAke1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbGxpc2lvbi5pZFxyXG4gICAgICAgICAgICAgICAgfSBhdCBbJHtjb2xsaXNpb24ueH0sJHtjb2xsaXNpb24ueX1dYCxcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgLy8gU2hvcnQgY2lyY3VpdCBzbyB3ZSBjYW4ndCBpbmZpbml0ZSBsb29wXHJcbiAgICAgICAgICAgIGlmIChjb2xsaXNpb24ubW92ZWQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIERvbid0IG1vdmUgc3RhdGljIGl0ZW1zIC0gd2UgaGF2ZSB0byBtb3ZlICp0aGlzKiBlbGVtZW50IGF3YXlcclxuICAgICAgICAgICAgaWYgKGNvbGxpc2lvbi5zdGF0aWMpIHtcclxuICAgICAgICAgICAgICAgIGxheW91dCA9IG1vdmVFbGVtZW50c0F3YXlGcm9tQ29sbGlzaW9uKFxyXG4gICAgICAgICAgICAgICAgICAgIGxheW91dCxcclxuICAgICAgICAgICAgICAgICAgICBjb2xsaXNpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5sLFxyXG4gICAgICAgICAgICAgICAgICAgIGlzVXNlckFjdGlvbixcclxuICAgICAgICAgICAgICAgICAgICBjb21wYWN0VHlwZSxcclxuICAgICAgICAgICAgICAgICAgICBjb2xzLFxyXG4gICAgICAgICAgICAgICAgICAgIG1vdmluZ1VwVXNlclxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGxheW91dCA9IG1vdmVFbGVtZW50c0F3YXlGcm9tQ29sbGlzaW9uKFxyXG4gICAgICAgICAgICAgICAgICAgIGxheW91dCxcclxuICAgICAgICAgICAgICAgICAgICBpdGVtLmwsXHJcbiAgICAgICAgICAgICAgICAgICAgY29sbGlzaW9uLFxyXG4gICAgICAgICAgICAgICAgICAgIGlzVXNlckFjdGlvbixcclxuICAgICAgICAgICAgICAgICAgICBjb21wYWN0VHlwZSxcclxuICAgICAgICAgICAgICAgICAgICBjb2xzLFxyXG4gICAgICAgICAgICAgICAgICAgIG1vdmluZ1VwVXNlclxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBsYXlvdXQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBtb3ZlRWxlbWVudHNBd2F5RnJvbUNvbGxpc2lvbihcclxuICAgIGxheW91dDogTGF5b3V0LFxyXG4gICAgY29sbGlkZXNXaXRoOiBMYXlvdXRJdGVtLFxyXG4gICAgaXRlbVRvTW92ZTogTGF5b3V0SXRlbSxcclxuICAgIGlzVXNlckFjdGlvbjogYm9vbGVhbiB8IG51bGwgfCB1bmRlZmluZWQsXHJcbiAgICBjb21wYWN0VHlwZTogQ29tcGFjdFR5cGUsXHJcbiAgICBjb2xzOiBudW1iZXIsXHJcbiAgICBtb3ZpbmdVcDogYm9vbGVhbiB8IHVuZGVmaW5lZFxyXG4pOiBMYXlvdXQge1xyXG4gICAgY29uc3QgY29tcGFjdEggPSBjb21wYWN0VHlwZSA9PT0gJ2hvcml6b250YWwnO1xyXG4gICAgLy8gQ29tcGFjdCB2ZXJ0aWNhbGx5IGlmIG5vdCBzZXQgdG8gaG9yaXpvbnRhbFxyXG4gICAgY29uc3QgY29tcGFjdFYgPSBjb21wYWN0VHlwZSAhPT0gJ2hvcml6b250YWwnO1xyXG4gICAgY29uc3QgcHJldmVudENvbGxpc2lvbiA9IGNvbGxpZGVzV2l0aC5zdGF0aWM7IC8vIHdlJ3JlIGFscmVhZHkgY29sbGlkaW5nIChub3QgZm9yIHN0YXRpYyBpdGVtcylcclxuXHJcbiAgICAvLyBJZiB0aGVyZSBpcyBlbm91Z2ggc3BhY2UgYWJvdmUgdGhlIGNvbGxpc2lvbiB0byBwdXQgdGhpcyBlbGVtZW50LCBtb3ZlIGl0IHRoZXJlLlxyXG4gICAgLy8gV2Ugb25seSBkbyB0aGlzIG9uIHRoZSBtYWluIGNvbGxpc2lvbiBhcyB0aGlzIGNhbiBnZXQgZnVua3kgaW4gY2FzY2FkZXMgYW5kIGNhdXNlXHJcbiAgICAvLyB1bndhbnRlZCBzd2FwcGluZyBiZWhhdmlvci5cclxuICAgIGlmIChpc1VzZXJBY3Rpb24pIHtcclxuICAgICAgICAvLyBSZXNldCBpc1VzZXJBY3Rpb24gZmxhZyBiZWNhdXNlIHdlJ3JlIG5vdCBpbiB0aGUgbWFpbiBjb2xsaXNpb24gYW55bW9yZS5cclxuICAgICAgICBpc1VzZXJBY3Rpb24gPSBmYWxzZTtcclxuXHJcbiAgICAgICAgLy8gTWFrZSBhIG1vY2sgaXRlbSBzbyB3ZSBkb24ndCBtb2RpZnkgdGhlIGl0ZW0gaGVyZSwgb25seSBtb2RpZnkgaW4gbW92ZUVsZW1lbnQuXHJcbiAgICAgICAgY29uc3QgZmFrZUl0ZW06IExheW91dEl0ZW0gPSB7XHJcbiAgICAgICAgICAgIHg6IGNvbXBhY3RIXHJcbiAgICAgICAgICAgICAgICA/IE1hdGgubWF4KGNvbGxpZGVzV2l0aC54IC0gaXRlbVRvTW92ZS53LCAwKVxyXG4gICAgICAgICAgICAgICAgOiBpdGVtVG9Nb3ZlLngsXHJcbiAgICAgICAgICAgIHk6IGNvbXBhY3RWXHJcbiAgICAgICAgICAgICAgICA/IE1hdGgubWF4KGNvbGxpZGVzV2l0aC55IC0gaXRlbVRvTW92ZS5oLCAwKVxyXG4gICAgICAgICAgICAgICAgOiBpdGVtVG9Nb3ZlLnksXHJcbiAgICAgICAgICAgIHc6IGl0ZW1Ub01vdmUudyxcclxuICAgICAgICAgICAgaDogaXRlbVRvTW92ZS5oLFxyXG4gICAgICAgICAgICBpZDogJy0xJyxcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvLyBObyBjb2xsaXNpb24/IElmIHNvLCB3ZSBjYW4gZ28gdXAgdGhlcmU7IG90aGVyd2lzZSwgd2UnbGwgZW5kIHVwIG1vdmluZyBkb3duIGFzIG5vcm1hbFxyXG4gICAgICAgIGlmICghZ2V0Rmlyc3RDb2xsaXNpb24obGF5b3V0LCBmYWtlSXRlbSkpIHtcclxuICAgICAgICAgICAgbG9nTXVsdGkoXHJcbiAgICAgICAgICAgICAgICBgRG9pbmcgcmV2ZXJzZSBjb2xsaXNpb24gb24gJHtpdGVtVG9Nb3ZlLmlkfSB1cCB0byBbJHtcclxuICAgICAgICAgICAgICAgICAgICBmYWtlSXRlbS54XHJcbiAgICAgICAgICAgICAgICB9LCR7ZmFrZUl0ZW0ueX1dLmAsXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHJldHVybiBtb3ZlRWxlbWVudHMoXHJcbiAgICAgICAgICAgICAgICBsYXlvdXQsXHJcbiAgICAgICAgICAgICAgICBbe1xyXG4gICAgICAgICAgICAgICAgICAgIGw6IGl0ZW1Ub01vdmUsXHJcbiAgICAgICAgICAgICAgICAgICAgeDogY29tcGFjdEggPyBmYWtlSXRlbS54IDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgICAgIHk6IGNvbXBhY3RWID8gZmFrZUl0ZW0ueSA6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgICAgIH1dLFxyXG4gICAgICAgICAgICAgICAgaXNVc2VyQWN0aW9uLFxyXG4gICAgICAgICAgICAgICAgY29tcGFjdFR5cGUsXHJcbiAgICAgICAgICAgICAgICBjb2xzLFxyXG4gICAgICAgICAgICAgICAgbW92aW5nVXBcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIG1vdmVFbGVtZW50cyhcclxuICAgICAgICBsYXlvdXQsXHJcbiAgICAgICAgW3tcclxuICAgICAgICAgICAgbDogaXRlbVRvTW92ZSxcclxuICAgICAgICAgICAgeDogY29tcGFjdEggPyBpdGVtVG9Nb3ZlLngrMSA6IHVuZGVmaW5lZCxcclxuICAgICAgICAgICAgeTogY29tcGFjdFYgPyBpdGVtVG9Nb3ZlLnkrMSA6IHVuZGVmaW5lZCxcclxuICAgICAgICB9XSxcclxuICAgICAgICBpc1VzZXJBY3Rpb24sXHJcbiAgICAgICAgY29tcGFjdFR5cGUsXHJcbiAgICAgICAgY29scyxcclxuICAgICAgICBtb3ZpbmdVcFxyXG4gICAgKTtcclxufVxyXG5cclxuZnVuY3Rpb24gbG9nTXVsdGkoLi4uYXJncykge1xyXG4gICAgaWYgKCFERUJVRykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXHJcbiAgICBjb25zb2xlLmxvZyguLi5hcmdzKTtcclxufVxyXG5cclxuIl19